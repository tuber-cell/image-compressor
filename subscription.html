<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PixTrim Pro Subscription</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <style>
    /* === CSS Styles === */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea, #764ba2);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 500px;
      width: 100%;
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    header h1 {
      font-size: 28px;
      color: #4e54c8;
      margin-bottom: 8px;
    }

    header p {
      color: #666;
    }

    .subscription-card {
      margin: 20px 0;
    }

    .card {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 25px;
      position: relative;
      border: 1px solid #e0e0e0;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    }

    .popular-badge {
      position: absolute;
      top: -12px;
      right: 20px;
      background: #4e54c8;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .card h2 {
      font-size: 22px;
      margin-bottom: 15px;
      color: #444;
    }

    .price {
      margin: 20px 0;
      display: flex;
      align-items: flex-end;
      gap: 5px;
    }

    .price .amount {
      font-size: 36px;
      font-weight: 700;
      color: #4e54c8;
    }

    .price .period {
      font-size: 16px;
      color: #777;
      margin-bottom: 5px;
    }

    .features {
      margin: 25px 0;
      list-style: none;
    }

    .features li {
      padding: 8px 0;
      position: relative;
      padding-left: 30px;
    }

    .features li:before {
      content: "‚úì";
      position: absolute;
      left: 0;
      color: #4CAF50;
      font-weight: bold;
    }

    .btn {
      width: 100%;
      padding: 14px;
      background: #4e54c8;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.3s;
      margin-top: 15px;
    }

    .btn:hover {
      background: #4348a1;
    }

    .btn.secondary {
      background: #f1f1f1;
      color: #333;
    }

    .btn.secondary:hover {
      background: #e0e0e0;
    }

    .small-text {
      font-size: 12px;
      color: #777;
      text-align: center;
      margin-top: 15px;
    }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 1000;
    }

    .spinner {
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 5px solid #4e54c8;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-overlay p {
      color: white;
      margin-top: 15px;
    }

    /* Login Prompt */
    .login-prompt {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1001;
    }

    .login-box {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      animation: popIn 0.3s ease-out;
    }

    @keyframes popIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .login-box h3 {
      margin-bottom: 15px;
      color: #444;
    }

    .login-box p {
      color: #666;
      margin-bottom: 20px;
    }

    .buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .buttons .btn {
      margin: 0;
      flex: 1;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .container {
        padding: 20px;
      }
      
      .card {
        padding: 20px;
      }
      
      .price .amount {
        font-size: 30px;
      }
      
      .buttons {
        flex-direction: column;
      }
    }
  /* === Navigation Bar Styles === */
.navbar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: rgba(255, 255, 255, 0.9);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  z-index: 1000;
  display: flex;
  justify-content: center;
  padding: 10px 0;
  backdrop-filter: blur(10px);
  transition: background 0.3s ease;
}

body.dark-mode .navbar {
  background: rgba(30, 30, 30, 0.9);
}

.navbar a {
  color: #444;
  text-decoration: none;
  font-size: 1rem;
  margin: 0 15px;
  padding: 8px 16px;
  border-radius: 5px;
  transition: background 0.3s ease, color 0.3s ease;
}

body.dark-mode .navbar a {
  color: #ffffff;
}

.navbar a:hover {
  background: #667eea;
  color: #fff;
}

/* === Modal Styles === */
.modal {
  display: none;
  position: fixed;
  z-index: 2000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.7);
}

.modal-content {
  background-color: #fefefe;
  margin: 10% auto;
  padding: 20px;
  border-radius: 10px;
  width: 80%;
  max-width: 400px;
  position: relative;
}

body.dark-mode .modal-content {
  background-color: #2c2c2c;
  color: #fff;
}

.close {
  position: absolute;
  right: 20px;
  top: 10px;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

#auth-forms input {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border-radius: 5px;
  border: 1px solid #ddd;
}

body.dark-mode #auth-forms input {
  background-color: #1e1e1e;
  color: #fff;
  border-color: #444;
}

#auth-forms button {
  width: 100%;
  padding: 10px;
  background: #667eea;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  margin-top: 10px;
}

#auth-forms button:hover {
  background: #5a6fd1;
}

#auth-forms p {
  text-align: center;
  margin-top: 15px;
}

#auth-forms a {
  color: #667eea;
  cursor: pointer;
  text-decoration: underline;
}

#auth-forms {
  padding: 20px;
}

.form-message {
  margin-top: 15px;
  padding: 10px;
  border-radius: 5px;
  display: none;
}

.success {
  background-color: #d4edda;
  color: #155724;
}

body.dark-mode .success {
  background-color: #155724;
  color: #d4edda;
}

.error {
  background-color: #f8d7da;
  color: #721c24;
}

body.dark-mode .error {
  background-color: #721c24;
  color: #f8d7da;
}

/* Adjust container position to account for navbar */
.container {
  margin-top: 80px;
}
  </style>
</head>
<body>
  
 <!-- Navigation Bar (same as home page) -->
<div class="navbar">
  <a href="/">üè† Home</a>
  <a href="/blog.html">üìù Blog</a>
  <a href="subscription.html">üíé Subscribe</a>
  <a href="#" id="auth-link">üîí Login</a>
</div>

<!-- Auth Modal (same as home page) -->
<div id="auth-modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <div id="auth-forms">
      <h2>Welcome to PixTrim</h2>
      <div id="signup-form">
        <input type="email" id="signup-email" placeholder="Email" required>
        <input type="password" id="signup-password" placeholder="Password (min 6 characters)" required>
        <button id="signup-btn">Sign Up</button>
        <div id="signup-message" class="form-message"></div>
        <p>Already have an account? <a href="#" id="show-login">Login</a></p>
      </div>
      <div id="login-form" style="display: none;">
        <input type="email" id="login-email" placeholder="Email" required>
        <input type="password" id="login-password" placeholder="Password" required>
        <button id="login-btn">Login</button>
        <div id="login-message" class="form-message"></div>
        <p>Don't have an account? <a href="#" id="show-signup">Sign Up</a></p>
      </div>
    </div>
  </div>
</div> 
  
  <div class="container">
    <!-- Header -->
    <header>
      <h1>PixTrim Pro</h1>
      <p>Unlock unlimited image compression</p>
    </header>

    <!-- Subscription Card -->
    <div class="subscription-card">
      <div class="card popular">
        <div class="popular-badge">BEST VALUE</div>
        <h2>Annual Plan</h2>
        <div class="price">
          <span class="amount">‚Çπ499</span>
          <span class="period">/ year</span>
        </div>
        <ul class="features">
          <li>Unlimited image compressions</li>
          <li>No file size limits</li>
          <li>Priority support</li>
          <li>No watermarks</li>
          <li>Cancel anytime</li>
        </ul>
        <button id="subscribeBtn" class="btn">Subscribe Now</button>
        <p class="small-text">Safe & secure payment via Razorpay</p>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="spinner"></div>
      <p>Processing your subscription...</p>
    </div>

    <!-- Login Prompt -->
    <div id="loginPrompt" class="login-prompt">
      <div class="login-box">
        <h3>Login Required</h3>
        <p>You need to be logged in to subscribe to PixTrim Pro.</p>
        <div class="buttons">
          <button id="loginBtn" class="btn">Login</button>
          <button id="cancelBtn" class="btn secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>

<script>
// === JavaScript ===
const firebaseConfig = {
  apiKey: "AIzaSyAZ_dD2VMAV023Vfyyevh0ud2CsxA2HDfQ",
  authDomain: "pixtrimpr.firebaseapp.com",
  projectId: "pixtrimpr",
  storageBucket: "pixtrimpr.firebasestorage.app",
  messagingSenderId: "168373294033",
  appId: "1:168373294033:web:4256e1e7e8bb5cc81846f0"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

// Subscription elements
const subscribeBtn = document.getElementById('subscribeBtn');
const loadingOverlay = document.getElementById('loadingOverlay');
const loginPrompt = document.getElementById('loginPrompt');
const promptLoginBtn = document.getElementById('loginBtn');
const cancelBtn = document.getElementById('cancelBtn');

// Auth modal elements
const modal = document.getElementById('auth-modal');
const authLink = document.getElementById('auth-link');
const closeBtn = document.querySelector('.close');
const showLogin = document.getElementById('show-login');
const showSignup = document.getElementById('show-signup');
const signupForm = document.getElementById('signup-form');
const loginForm = document.getElementById('login-form');
const signupBtn = document.getElementById('signup-btn');
const loginBtn = document.getElementById('login-btn');
const signupMessage = document.getElementById('signup-message');
const loginMessage = document.getElementById('login-message');

// Auth state listener
auth.onAuthStateChanged((user) => {
  if (user) {
    // User is signed in
    authLink.textContent = 'üë§ Account';
  } else {
    // No user is signed in
    authLink.textContent = 'üîí Login';
  }
});

// Modal functionality
authLink.addEventListener('click', (e) => {
  e.preventDefault();
  if (auth.currentUser) {
    // User is logged in, redirect to account page
    window.location.href = 'account.html';
  } else {
    modal.style.display = 'block';
    // Show signup form by default
    loginForm.style.display = 'none';
    signupForm.style.display = 'block';
    // Clear messages
    signupMessage.style.display = 'none';
    loginMessage.style.display = 'none';
  }
});

closeBtn.addEventListener('click', () => {
  modal.style.display = 'none';
});

showLogin.addEventListener('click', (e) => {
  e.preventDefault();
  signupForm.style.display = 'none';
  loginForm.style.display = 'block';
  signupMessage.style.display = 'none';
});

showSignup.addEventListener('click', (e) => {
  e.preventDefault();
  loginForm.style.display = 'none';
  signupForm.style.display = 'block';
  loginMessage.style.display = 'none';
});

window.addEventListener('click', (e) => {
  if (e.target === modal) {
    modal.style.display = 'none';
  }
  if (e.target === loginPrompt) {
    loginPrompt.style.display = 'none';
  }
});

// Sign up
signupBtn.addEventListener('click', () => {
  const email = document.getElementById('signup-email').value;
  const password = document.getElementById('signup-password').value;
  
  // Validate password length
  if (password.length < 6) {
    showMessage(signupMessage, 'Password must be at least 6 characters', 'error');
    return;
  }

  auth.createUserWithEmailAndPassword(email, password)
    .then((userCredential) => {
      // Create user document in Firestore
      return firebase.firestore().collection('users').doc(userCredential.user.uid).set({
        email: email,
        usageCount: 0,
        isSubscribed: false,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        anonymousUses: localStorage.getItem('anonymousUsage') || 0
      });
    })
    .then(() => {
      showMessage(signupMessage, 'Account created successfully! Redirecting...', 'success');
      // Clear localStorage anonymous usage
      localStorage.removeItem('anonymousUsage');
      // Close modal after 2 seconds
      setTimeout(() => {
        modal.style.display = 'none';
      }, 2000);
    })
    .catch((error) => {
      showMessage(signupMessage, error.message, 'error');
    });
});

// Login
loginBtn.addEventListener('click', () => {
  const email = document.getElementById('login-email').value;
  const password = document.getElementById('login-password').value;
  
  auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      showMessage(loginMessage, 'Logged in successfully! Redirecting...', 'success');
      // Close modal after 2 seconds
      setTimeout(() => {
        modal.style.display = 'none';
        // Also close the login prompt if it's open
        loginPrompt.style.display = 'none';
      }, 2000);
    })
    .catch((error) => {
      showMessage(loginMessage, error.message, 'error');
    });
});

// Login prompt buttons
promptLoginBtn.addEventListener('click', () => {
  loginPrompt.style.display = 'none';
  modal.style.display = 'block';
  // Show login form
  signupForm.style.display = 'none';
  loginForm.style.display = 'block';
  signupMessage.style.display = 'none';
});

cancelBtn.addEventListener('click', () => {
  loginPrompt.style.display = 'none';
});

// Subscription button
subscribeBtn.addEventListener('click', async () => {
  const user = auth.currentUser;

  if (!user) {
    loginPrompt.style.display = 'flex';
    return;
  }

  loadingOverlay.style.display = 'flex';

  try {
    const token = await user.getIdToken();

    const response = await fetch('https://pixtrim7.onrender.com/create-subscription', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({ plan: "pro-annual" })
    });

    if (!response.ok) throw new Error(await response.text());

    const data = await response.json();
    console.log("Subscription API result:", data);

    const { subscriptionId, key, userEmail, userName } = data;

    const options = {
      key: key,
      subscription_id: subscriptionId,
      name: "PixTrim Pro",
      description: "Annual Subscription - ‚Çπ499/year",
      image: "https://pixtrim.com/logo.png", // Optional: add your logo URL
      handler: function (response) {
        alert("Payment successful! Razorpay ID: " + response.razorpay_payment_id);
        // Optionally redirect to a success page or refresh
        window.location.href = "/thank-you.html";
      },
      prefill: {
        name: userName || user.displayName || "PixTrim User",
        email: userEmail || user.email
      },
      theme: {
        color: "#4e54c8"
      }
    };

    const rzp = new Razorpay(options);
    rzp.open();
  } catch (error) {
    console.error("Subscription Error:", error);
    alert("Something went wrong: " + error.message);
  } finally {
    loadingOverlay.style.display = 'none';
  }
});

// Helper function to show messages
function showMessage(element, message, type) {
  element.textContent = message;
  element.className = `form-message ${type}`;
  element.style.display = 'block';
}
</script>
</body>
</html>


