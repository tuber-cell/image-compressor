<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PixTrim - Free Image Compressor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "PixTrim",
      "url": "https://image-compressor-five-azure.vercel.app",
      "logo": "https://image-compressor-five-azure.vercel.app/logo.jpg"
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    /* General Styles */
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #333;
      overflow-x: hidden;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body.dark-mode {
      background: #121212;
      color: #ffffff;
    }

    /* Navigation Bar */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      display: flex;
      justify-content: center;
      padding: 10px 0;
      backdrop-filter: blur(10px);
      transition: background 0.3s ease;
    }

    body.dark-mode .navbar {
      background: rgba(30, 30, 30, 0.9);
    }

    .navbar a {
      color: #444;
      text-decoration: none;
      font-size: 1rem;
      margin: 0 15px;
      padding: 8px 16px;
      border-radius: 5px;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body.dark-mode .navbar a {
      color: #ffffff;
    }

    .navbar a:hover {
      background: #667eea;
      color: #fff;
    }

    /* Hero Section */
    .hero {
      text-align: center;
      padding: 6rem 2rem 4rem;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      margin: 80px 1rem 2rem;
      width: 90%;
      max-width: 800px;
      animation: fadeIn 1s ease-in-out;
    }

    body.dark-mode .hero {
      background: rgba(30, 30, 30, 0.95);
    }

    .hero h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: #444;
    }

    body.dark-mode .hero h1 {
      color: #ffffff;
    }

    .hero p {
      font-size: 1.2rem;
      color: #666;
      margin-bottom: 2rem;
    }

    body.dark-mode .hero p {
      color: #ccc;
    }

    /* Upload Section */
    .upload-section {
      margin-bottom: 2rem;
    }

    .upload-section input[type="file"] {
      display: none;
    }

    .upload-section label {
      background: #667eea;
      color: #fff;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s ease, transform 0.3s ease;
      display: inline-block;
    }

    .upload-section label:hover {
      background: #5a6fd1;
      transform: scale(1.05);
    }

    /* Compression Level */
    .compress-level {
      margin: 1rem 0;
    }

    .compress-level label {
      font-size: 1rem;
      color: #555;
      display: block;
      margin-bottom: 10px;
    }

    body.dark-mode .compress-level label {
      color: #ccc;
    }

    .compress-level input[type="range"] {
      width: 100%;
      margin-top: 10px;
      -webkit-appearance: none;
      appearance: none;
      height: 8px;
      background: #e0e0e0;
      border-radius: 5px;
      outline: none;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .compress-level input[type="range"]:hover {
      opacity: 1;
    }

    .compress-level input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #667eea;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }

    .compress-level input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }

    /* Results Table */
    .results-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 2rem;
    }

    .results-table th,
    .results-table td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: center;
    }

    body.dark-mode .results-table th,
    body.dark-mode .results-table td {
      background: #2c2c2c;
      color: #ffffff;
      border-color: #444;
    }

    .results-table th {
      background: #667eea;
      color: #fff;
      font-weight: 500;
    }

    .results-table td {
      background: #f9f9f9;
    }

    body.dark-mode .results-table td {
      background: #1e1e1e;
    }

    .emoji {
      font-size: 1.2rem;
    }

    .download-btn {
      background: #28a745;
      color: #fff;
      padding: 8px 16px;
      border-radius: 5px;
      text-decoration: none;
      font-size: 0.9rem;
      transition: background 0.3s ease, transform 0.3s ease;
    }

    .download-btn:hover {
      background: #218838;
      transform: scale(1.05);
    }

    /* Feature Section */
    .features {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin: 2rem 0;
      width: 90%;
      max-width: 1200px;
    }

    .feature {
      background: rgba(255, 255, 255, 0.95);
      padding: 1.5rem;
      border-radius: 10px;
      text-align: center;
      width: 30%;
      margin: 1rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    body.dark-mode .feature {
      background: rgba(30, 30, 30, 0.95);
    }

    .feature:hover {
      transform: translateY(-10px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .feature .emoji {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .feature h3 {
      font-size: 1.2rem;
      color: #444;
      margin-bottom: 0.5rem;
    }

    body.dark-mode .feature h3 {
      color: #ffffff;
    }

    .feature p {
      font-size: 0.9rem;
      color: #666;
    }

    body.dark-mode .feature p {
      color: #ccc;
    }

    /* Testimonial Section */
    .testimonials {
      background: rgba(255, 255, 255, 0.95);
      padding: 2rem;
      border-radius: 15px;
      margin: 2rem 0;
      text-align: center;
      width: 90%;
      max-width: 800px;
    }

    body.dark-mode .testimonials {
      background: rgba(30, 30, 30, 0.95);
    }

    .testimonials h2 {
      font-size: 2rem;
      color: #444;
      margin-bottom: 2rem;
    }

    body.dark-mode .testimonials h2 {
      color: #ffffff;
    }

    .testimonial {
      background: #f9f9f9;
      padding: 1.5rem;
      border-radius: 10px;
      margin: 1rem 0;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .testimonial {
      background: #2c2c2c;
    }

    .testimonial p {
      font-size: 1rem;
      color: #666;
      margin-bottom: 0.5rem;
    }

    body.dark-mode .testimonial p {
      color: #ccc;
    }

    .testimonial span {
      font-size: 0.9rem;
      color: #888;
    }

    body.dark-mode .testimonial span {
      color: #aaa;
    }

    /* Footer */
    footer {
      background: rgba(255, 255, 255, 0.95);
      padding: 1rem;
      text-align: center;
      margin-top: 2rem;
      border-top: 1px solid #ddd;
      width: 100%;
    }

    body.dark-mode footer {
      background: rgba(30, 30, 30, 0.95);
    }

    .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .footer-content p {
      margin: 0;
      color: #666;
    }

    body.dark-mode .footer-content p {
      color: #ccc;
    }

    .social-links a {
      color: #667eea;
      text-decoration: none;
      margin: 0 10px;
      transition: color 0.3s ease;
    }

    .social-links a:hover {
      color: #5a6fd1;
    }

    /* Dark Mode Toggle */
    #dark-mode-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #667eea;
      color: #fff;
      border: none;
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      transition: background 0.3s ease, transform 0.3s ease;
    }

    #dark-mode-toggle:hover {
      background: #5a6fd1;
      transform: scale(1.1);
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .hero, .features, .testimonials, footer {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
    }
    
    .modal-content {
      background-color: #fefefe;
      margin: 10% auto;
      padding: 20px;
      border-radius: 10px;
      width: 80%;
      max-width: 400px;
      position: relative;
    }
    
    body.dark-mode .modal-content {
      background-color: #2c2c2c;
      color: #fff;
    }
    
    .close {
      position: absolute;
      right: 20px;
      top: 10px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    #auth-forms input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    
    body.dark-mode #auth-forms input {
      background-color: #1e1e1e;
      color: #fff;
      border-color: #444;
    }
    
    #auth-forms button {
      width: 100%;
      padding: 10px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }
    
    #auth-forms button:hover {
      background: #5a6fd1;
    }
    
    #auth-forms p {
      text-align: center;
      margin-top: 15px;
    }
    
    #auth-forms a {
      color: #667eea;
      cursor: pointer;
      text-decoration: underline;
    }

    #auth-forms {
      padding: 20px;
    }

    .form-message {
      margin-top: 15px;
      padding: 10px;
      border-radius: 5px;
      display: none;
    }

    .success {
      background-color: #d4edda;
      color: #155724;
    }

    body.dark-mode .success {
      background-color: #155724;
      color: #d4edda;
    }

    .error {
      background-color: #f8d7da;
      color: #721c24;
    }

    body.dark-mode .error {
      background-color: #721c24;
      color: #f8d7da;
    }

    /* Usage Counter */
    .usage-counter {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px 15px;
      border-radius: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      font-size: 0.9rem;
      z-index: 1000;
    }

    body.dark-mode .usage-counter {
      background: rgba(30, 30, 30, 0.9);
      color: #fff;
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <div class="navbar">
    <a href="/">üè† Home</a>
    <a href="/blog.html">üìù Blog</a>
    <a href="subscription.html">üíé Subscribe</a>
    <a href="#" id="auth-link">üîí Login</a>
  </div>

  <!-- Auth Modal -->
  <div id="auth-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="auth-forms">
        <h2>Welcome to PixTrim</h2>
        <div id="signup-form">
          <input type="email" id="signup-email" placeholder="Email" required>
          <input type="password" id="signup-password" placeholder="Password (min 6 characters)" required>
          <button id="signup-btn">Sign Up</button>
          <div id="signup-message" class="form-message"></div>
          <p>Already have an account? <a href="#" id="show-login">Login</a></p>
        </div>
        <div id="login-form" style="display: none;">
          <input type="email" id="login-email" placeholder="Email" required>
          <input type="password" id="login-password" placeholder="Password" required>
          <button id="login-btn">Login</button>
          <div id="login-message" class="form-message"></div>
          <p>Don't have an account? <a href="#" id="show-signup">Sign Up</a></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Hero Section -->
  <div class="hero">
    <h1>üì∑ PixTrim</h1>
    <p>Compress your images effortlessly and optimize your website's performance.</p>
    <div class="upload-section">
      <label for="file-input">üì§ Upload Image</label>
      <input type="file" id="file-input" accept="image/*">
    </div>
    <div class="compress-level">
      <label for="compress-range">üîß Compression Level: <span id="compress-value">50</span>%</label>
      <div style="display: flex; align-items: center; gap: 10px;">
        <span>Decrease ‚Üê</span>
        <input type="range" id="compress-range" min="1" max="100" value="50">
        <span>‚Üí Increase</span>
      </div>
    </div>
  </div>
  
  <!-- Results Table -->
  <div class="container">
    <table class="results-table">
      <thead>
        <tr>
          <th>üìÑ File Name</th>
          <th>üìè Original Size</th>
          <th>üìâ Compressed Size</th>
          <th>üöÄ Action</th>
        </tr>
      </thead>
      <tbody id="results-body">
        <!-- Results will be populated here -->
      </tbody>
    </table>
  </div>
  
  <!-- Feature Section -->
  <div class="features">
    <div class="feature">
      <span class="emoji">‚ö°</span>
      <h3>Fast Compression</h3>
      <p>Compress images in seconds without losing quality.</p>
    </div>
   
   <div class="feature">
      <span class="emoji">üì±</span>
      <h3>Responsive Design</h3>
      <p>Optimized for all devices, from desktop to mobile.</p>
    </div>
    <div class="feature">
      <span class="emoji">üîí</span>
      <h3>Secure & Private</h3>
      <p>Your images are never stored or shared.</p>
    </div>
  </div>

  <!-- Testimonial Section -->
  <div class="testimonials">
    <h2>What Our Users Say</h2>
    <div class="testimonial">
      <p>"PixTrim made optimizing my website images so easy! Highly recommended."</p>
      <span>- Jane Doe, Web Developer</span>
    </div>
    <div class="testimonial">
      <p>"The compression quality is amazing, and the interface is super intuitive."</p>
      <span>- John Smith, Photographer</span>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <p>¬© 2023 PixTrim. All rights reserved.</p>
      <div class="social-links">
        <a href="#">Twitter</a>
        <a href="#">LinkedIn</a>
        <a href="#">GitHub</a>
      </div>
    </div>
  </footer>

  <!-- Dark Mode Toggle -->
  <button id="dark-mode-toggle">üåô</button>

  <!-- Usage Counter -->
  <div class="usage-counter" id="usage-counter" style="display: none;">
    Free uses left: <span id="remaining-uses">3</span>/3
  </div>

  <!-- Firebase and other scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <!-- Vercel Analytics Script -->
  <script type="module">
    import { inject } from 'https://unpkg.com/@vercel/analytics';
    inject();
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-W34PSKXY8J"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-W34PSKXY8J');
  </script>

  <script>
    // Firebase configuration - REPLACE WITH YOUR ACTUAL CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyDvfRTDul7CnlwW_casoslvAwEDhvOvbv0",
      authDomain: "pixtrim.firebaseapp.com",
      projectId: "pixtrim",
      storageBucket: "pixtrim.firebasestorage.app",
      messagingSenderId: "268832698971",
      appId: "1:268832698971:web:2991712732b74fa4bbc57e"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM Elements
    const fileInput = document.getElementById('file-input');
    const compressRange = document.getElementById('compress-range');
    const compressValue = document.getElementById('compress-value');
    const resultsBody = document.getElementById('results-body');
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const body = document.body;
    const modal = document.getElementById('auth-modal');
    const authLink = document.getElementById('auth-link');
    const closeBtn = document.querySelector('.close');
    const showLogin = document.getElementById('show-login');
    const showSignup = document.getElementById('show-signup');
    const signupForm = document.getElementById('signup-form');
    const loginForm = document.getElementById('login-form');
    const signupBtn = document.getElementById('signup-btn');
    const loginBtn = document.getElementById('login-btn');
    const signupMessage = document.getElementById('signup-message');
    const loginMessage = document.getElementById('login-message');
    const usageCounter = document.getElementById('usage-counter');
    const remainingUses = document.getElementById('remaining-uses');

    // Update compression level value
    compressRange.addEventListener('input', () => {
      compressValue.textContent = compressRange.value;
    });

    // Auth state listener
    auth.onAuthStateChanged((user) => {
      if (user) {
        // User is signed in
        authLink.textContent = 'üë§ Account';
        checkUserUsage(user.uid);
        updateUsageCounter(user.uid);
      } else {
        // No user is signed in
        authLink.textContent = 'üîí Login';
        updateAnonymousUsageCounter();
      }
    });

    // Modal functionality
    authLink.addEventListener('click', (e) => {
      e.preventDefault();
      if (auth.currentUser) {
        // User is logged in, redirect to account page
        window.location.href = 'account.html';
      } else {
        modal.style.display = 'block';
        // Show signup form by default
        loginForm.style.display = 'none';
        signupForm.style.display = 'block';
        // Clear messages
        signupMessage.style.display = 'none';
        loginMessage.style.display = 'none';
      }
    });

    closeBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    showLogin.addEventListener('click', (e) => {
      e.preventDefault();
      signupForm.style.display = 'none';
      loginForm.style.display = 'block';
      signupMessage.style.display = 'none';
    });

    showSignup.addEventListener('click', (e) => {
      e.preventDefault();
      loginForm.style.display = 'none';
      signupForm.style.display = 'block';
      loginMessage.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

    // Sign up
    signupBtn.addEventListener('click', () => {
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      
      // Validate password length
      if (password.length < 6) {
        showMessage(signupMessage, 'Password must be at least 6 characters', 'error');
        return;
      }

      auth.createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
          // Create user document in Firestore
          return db.collection('users').doc(userCredential.user.uid).set({
            email: email,
            usageCount: 0,
            isSubscribed: false,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            anonymousUses: localStorage.getItem('anonymousUsage') || 0
          });
        })
        .then(() => {
          showMessage(signupMessage, 'Account created successfully! Redirecting...', 'success');
          // Clear localStorage anonymous usage
          localStorage.removeItem('anonymousUsage');
          // Close modal after 2 seconds
          setTimeout(() => {
            modal.style.display = 'none';
          }, 2000);
        })
        .catch((error) => {
          showMessage(signupMessage, error.message, 'error');
        });
    });

    // Login
    loginBtn.addEventListener('click', () => {
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          showMessage(loginMessage, 'Logged in successfully! Redirecting...', 'success');
          // Close modal after 2 seconds
          setTimeout(() => {
            modal.style.display = 'none';
          }, 2000);
        })
        .catch((error) => {
          showMessage(loginMessage, error.message, 'error');
        });
    });

    // Show message in form
    function showMessage(element, message, type) {
      element.textContent = message;
      element.className = `form-message ${type}`;
      element.style.display = 'block';
    }

    // Check user's usage count
    function checkUserUsage(userId) {
      return db.collection('users').doc(userId).get()
        .then((doc) => {
          if (doc.exists) {
            const userData = doc.data();
            if (!userData.isSubscribed && userData.usageCount >= 3) {
              alert('You have reached your free limit. Please subscribe to continue using the service.');
              window.location.href = 'subscription.html';
              return false;
            }
            return true;
          }
          return true;
        });
    }

    // Track image compression usage
    function trackUsage(userId) {
      if (!userId) {
        // User is not logged in, track in localStorage
        let anonymousUsage = parseInt(localStorage.getItem('anonymousUsage') || 0);
        if (anonymousUsage >= 3) {
          alert('You have reached your free limit. Please sign up to continue using the service.');
          modal.style.display = 'block';
          return Promise.resolve(false);
        }
        anonymousUsage++;
        localStorage.setItem('anonymousUsage', anonymousUsage);
        updateAnonymousUsageCounter();
        return Promise.resolve(true);
      } else {
        // User is logged in, track in Firestore
        const userRef = db.collection('users').doc(userId);
        return db.runTransaction((transaction) => {
          return transaction.get(userRef).then((doc) => {
            if (!doc.exists) {
              throw "Document does not exist!";
            }
            
            const userData = doc.data();
            if (userData.isSubscribed) {
              return true; // Subscribed users have unlimited usage
            }
            
            if (userData.usageCount >= 3) {
              return false; // Free user has reached limit
            }
            
            transaction.update(userRef, {
              usageCount: firebase.firestore.FieldValue.increment(1)
            });
            return true;
          });
        }).then((result) => {
          if (!result) {
            alert('You have reached your free limit. Please subscribe to continue using the service.');
            window.location.href = 'subscription.html';
          }
          updateUsageCounter(userId);
          return result;
        }).catch((error) => {
          console.error("Transaction failed: ", error);
          return false;
        });
      }
    }

    // Update usage counter display for logged-in users
    function updateUsageCounter(userId) {
      db.collection('users').doc(userId).get().then((doc) => {
        if (doc.exists) {
          const userData = doc.data();
          if (userData.isSubscribed) {
            usageCounter.style.display = 'none';
          } else {
            const remaining = 3 - (userData.usageCount || 0);
            remainingUses.textContent = remaining;
            usageCounter.style.display = 'block';
          }
        }
      });
    }

    // Update usage counter display for anonymous users
    function updateAnonymousUsageCounter() {
      if (auth.currentUser) return; // Skip if user is logged in
      
      const anonymousUsage = parseInt(localStorage.getItem('anonymousUsage') || 0);
      const remaining = 3 - anonymousUsage;
      
      if (remaining <= 0) {
        usageCounter.style.display = 'none';
      } else {
        remainingUses.textContent = remaining;
        usageCounter.style.display = 'block';
      }
    }

    // Handle file upload and compression
    fileInput.addEventListener('change', async (event) => {
      const file = event.target.files[0];
      if (!file) return;

      // Check if user is allowed to compress
      const userId = auth.currentUser ? auth.currentUser.uid : null;
      const isAllowed = await trackUsage(userId);
      
      if (!isAllowed) {
        fileInput.value = ''; // Clear the file input
        return;
      }

      // Proceed with compression if allowed
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.src = e.target.result;

        img.onload = () => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');

          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

          const quality = compressRange.value / 100;
          canvas.toBlob(
            (blob) => {
              const compressedFile = new File([blob], file.name, {
                type: 'image/jpeg',
                lastModified: Date.now(),
              });
              displayResults(file, compressedFile);
            },
            'image/jpeg',
            quality
          );
        };
      };
      reader.readAsDataURL(file);
    });

    // Display results in the table
    function displayResults(originalFile, compressedFile) {
      const row = document.createElement('tr');

      // File Name
      const fileNameCell = document.createElement('td');
      fileNameCell.textContent = originalFile.name;
      fileNameCell.setAttribute('data-label', 'File Name');
      row.appendChild(fileNameCell);

      // Original Size
      const originalSizeCell = document.createElement('td');
      originalSizeCell.textContent = `${(originalFile.size / 1024).toFixed(2)} KB`;
      originalSizeCell.setAttribute('data-label', 'Original Size');
      row.appendChild(originalSizeCell);

      // Compressed Size
      const compressedSizeCell = document.createElement('td');
      compressedSizeCell.textContent = `${(compressedFile.size / 1024).toFixed(2)} KB`;
      compressedSizeCell.setAttribute('data-label', 'Compressed Size');
      row.appendChild(compressedSizeCell);

      // Download Button
      const actionCell = document.createElement('td');
      const downloadLink = document.createElement('a');
      downloadLink.href = URL.createObjectURL(compressedFile);
      downloadLink.download = `compressed_${originalFile.name}`;
      downloadLink.className = 'download-btn';
      downloadLink.textContent = '‚¨áÔ∏è Download';
      actionCell.setAttribute('data-label', 'Action');
      actionCell.appendChild(downloadLink);
      row.appendChild(actionCell);

      // Add row to table
      resultsBody.appendChild(row);
    }

    // Dark Mode Toggle
    darkModeToggle.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
      darkModeToggle.textContent = body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
      // Save preference to localStorage
      localStorage.setItem('darkMode', body.classList.contains('dark-mode'));
    });

    // Check for saved dark mode preference
    if (localStorage.getItem('darkMode') === 'true') {
      body.classList.add('dark-mode');
      darkModeToggle.textContent = '‚òÄÔ∏è';
    }

    // Scroll Animations
    const sections = document.querySelectorAll('.hero, .features, .testimonials, footer');

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      },
      { threshold: 0.1 }
    );

    sections.forEach((section) => observer.observe(section));

    // Initialize usage counter
    updateAnonymousUsageCounter();
  </script>
</body>
</html>
